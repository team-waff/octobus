var domain=$("body").data("domain"),baseroot=$("body").data("baseroot");$(document).ready(function(){function t(){var t=new TimelineMax,e=$(".open .enter-anim");t.staggerFrom(e,.3,{left:-60,autoAlpha:0},.1)}function e(t,e){$(".parent__view--listing").removeClass("parent__view--active"),$(".parent__view--map").addClass("parent__view--active");var n=L.map("map_parent",{zoomControl:!1});if(e)return n.off(),n.remove(),!1;$.getJSON("app/course/1").done(function(t){var e=t.start_pos.lat,i=t.start_pos.lng;n.setView([e,i],16),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets",zoomControl:!1,accessToken:"pk.eyJ1Ijoib2N0b2J1cyIsImEiOiJjanRrcmt2cnQxdTU5NDRteGluMnpxM2p1In0.Zm24PvVRygwc5BoipCjvMg"}).addTo(n);var o=L.icon({iconUrl:"graphics/marker_start.png",shadowUrl:"graphics/shadow.png",iconSize:[50,50],shadowSize:[50,50],iconAnchor:[25,25],shadowAnchor:[25,25],popupAnchor:[-3,-76]}),s=L.icon({iconUrl:"graphics/marker_end.png",shadowUrl:"graphics/shadow.png",iconSize:[50,50],shadowSize:[50,50],iconAnchor:[25,25],shadowAnchor:[25,25],popupAnchor:[-3,-76]}),r=L.icon({iconUrl:"graphics/marker_moving.png",shadowUrl:"graphics/shadow.png",iconSize:[50,50],shadowSize:[50,50],iconAnchor:[25,25],shadowAnchor:[25,25],popupAnchor:[-3,-76]});L.marker([t.points[t.points.length-1].lat,t.points[t.points.length-1].lng],{icon:s}).addTo(n);for(var l=L.marker([e,i],{icon:r}).addTo(n),c=0,d=t.points.length;c<d;c++)L.circle([t.points[c].lat,t.points[c].lng],{color:"#2297c9",fillColor:"#fff",fillOpacity:1,radius:2}).addTo(n);var p=!1,_=0;status_bus="riding",interval=setInterval(function(){var e=t.points[_].lat,i=t.points[_].lng;"riding"==status_bus&&(p||L.marker([t.start_pos.lat,t.start_pos.lng],{icon:o}).addTo(n),p=!0,n.removeLayer(l),l=L.marker([e,i],{icon:r}).addTo(n),n.panTo([e,i])),console.log(status_bus),_==t.points.length-1?(status_bus="stop",a(),window.clearInterval(interval)):_++},1500)})}function a(){$(".notif").addClass("notif--visible")}$(".enfant_detail_name").is(":visible")&&$.getJSON("app/child/"+id_enfant).done(function(t){$(".enfant_detail_name").text(t.firstname+" "+t.name),$(".enfant_detail_picture").attr("src","graphics/avatar_"+t.avatar+".png")}),$(".js_login").click(function(t){t.preventDefault();var e=0;$(".login__form").find(".form__input").each(function(){""==$(this).val()?(e++,$(this).parents(".form__line").addClass("form__line--error")):$(this).parents(".form__line").removeClass("form__line--error")}),0==e&&("enfant"==$("input[name=username]").val()?window.location.href="enfant.php?id=14":window.location.href="parent_choice.php")}),$(".login__form").on("keyup keypress",function(t){if(13==(t.keyCode||t.which))return t.preventDefault(),$(".js_login").trigger("click"),!1}),$(".json_listing_children").is(":visible")&&function(){$.getJSON("app/accountable/"+id_parent_global).done(function(t){console.info(t,1),$(".js_redirect_parent").attr("data-id",t.pk),$(".json_listing_parent__item-firstname").text(t.firstname),$(".json_listing_parent__item-lastname").text(t.name);for(var e=0,a=t.childs.length;e<a;e++)$(".json_listing_children__item").last().clone(!0).appendTo(".json_listing_children").attr("data-id",t.childs[e].pk).find(".json_listing_children__item-firstname").text(t.childs[e].firstname).parents(".json_listing_children__item").find(".json_listing_children__item-lastname").text(t.childs[e].name).parents(".json_listing_children__item").find(".json_listing_children__item-picture").attr("src","graphics/avatar_"+t.childs[e].avatar+".png");$(".json_listing_children").find(".json_listing_children__item").first().remove()})}(),$("body").on("click",".js_redirect_child",function(t){t.preventDefault();var e=$(this).parents(".json_listing_children__item").data("id");window.location.href="enfant.php?id="+e}),$("body").on("click",".js_redirect_parent",function(t){t.preventDefault();var e=$(this).data("id");window.location.href="parent.php?id="+e}),$(".json_children_active").is(":visible")&&function(){$.getJSON("app/accountable/"+id_parent_global).done(function(t){for(var e=0,a=t.childs.length;e<a;e++)$(".json_children_active__item").last().clone(!0).appendTo(".json_children_active").attr("data-id",t.childs[e].pk).find(".json_children_active-firstname").text(t.childs[e].firstname).parents(".json_children_active__item").find(".json_children_active-lastname").text(t.childs[e].name).parents(".json_children_active__item").find(".json_children_active-picture").attr("src","graphics/avatar_"+t.childs[e].avatar+".png");$(".json_children_active").find(".json_children_active__item").first().remove(),$(".json_children_active__item").each(function(){var t=$(this).data("id");$.getJSON("app/child/"+t).done(function(e){console.info(e,1);for(var a=0,n=e.rides.length;a<n;a++){var i=new Date(e.rides[a].start_time);$(".json_children_active__item[data-id="+t+"]").find(".json_trajets .json_trajet_active").last().clone(!0).appendTo(".json_children_active__item[data-id="+t+"] .json_trajets").attr("data-id",e.rides[a].course.pk).attr("data-status",e.rides[a].status).attr("data-name",e.firstname).attr("data-avatar",e.avatar).find(".json_trajet_active_start").text(i.getDate()+"/"+i.getMonth()+" - "+i.getHours()+":"+i.getMinutes()).parents(".json_trajet_active").find(".json_trajet_active_place").text(e.rides[a].course.name).parents(".json_trajet_active").find(".json_trajet_active_status").attr("data-status",e.rides[a].status)}})})})}(),$("body").on("click",".json_trajet_active",function(t){t.preventDefault();var a=$(this).data("status"),n=$(this).data("id"),i=$(this).data("name"),o=$(this).data("avatar");$(".json_map_name").text(i),$(".json_map_avatar").attr("src","graphics/avatar_"+o+".png"),"running"!=a&&"start"!=a||(e(n,!0),e(n,!1))});var n=function(){$(".global--parent").removeClass("animating")};$(".js_open_register").click(function(e){if(e.preventDefault(),!$(".global--parent").hasClass("animating")){$(".global--enfant").addClass("animating");var a=new TimelineMax,i=$(".slide[data-slide=select]");i.addClass("open"),t(),a.to(i,.5,{left:0,ease:Power3.easeOut,onComplete:n})}}),$(".notif").click(function(){$(this).hasClass("notif--visible")&&$(this).removeClass("notif--visible")}),$(".btn--return-parent").click(function(t){t.preventDefault(),$(".parent__view--listing").addClass("parent__view--active"),$(".parent__view--map").removeClass("parent__view--active")}),$("body").hasClass("page_parent")&&($.getJSON("app/accountable/"+id_parent_global).done(function(t){for(var e=0,a=t.childs.length;e<a;e++)$("#select_child").append('<option value="'+t.childs[e].pk+'">'+(t.childs[e].firstname?t.childs[e].firstname:"Empty")+"</option>");$("#select_child").selectric("refresh")}),$.getJSON("app/ride").done(function(t){for(var e=0,a=t.length;e<a;e++)$("#select_day").append('<option value="'+t[e].pk+'">'+(t[e].start_time?t[e].start_time:"Empty")+"</option>");$("#select_day").selectric("refresh")}));var i=!1;$(".js_register_child").click(function(t){t.preventDefault();var e=0;$(".slide--select-parent").find("select").each(function(){0==$(this).val()&&e++}),0==e&&(i||($.post("app/ride",{child:$("#select_child").val(),ride:$("#select_day").val()}),i=!0,$(".registration__step--step1").hide(),$(".registration__step--step2").show()))}),$(".js_close_child").click(function(t){t.preventDefault(),$(".btn--return").trigger("click")})});var domain=$("body").data("domain"),baseroot=$("body").data("baseroot");$(document).ready(function(){function t(t){$("body").addClass("no_scroll"),$(".popup").removeClass("popup--visible"),$(".popup[data-popup="+t+"]").addClass("popup--visible")}function e(t){$("body").removeClass("no_scroll"),$(".popup[data-popup="+t+"]").removeClass("popup--visible")}$(".js_menu_close").on("click",function(t){t.preventDefault(),$(".menu").removeClass("menu--open")}),$(".js_menu_open").on("click",function(t){t.preventDefault(),$(".menu").addClass("menu--open")}),$(".js_open_popup").on("click",function(e){e.preventDefault(),t($(this).data("popup"))}),$(".js_close_popup").on("click",function(t){t.preventDefault(),e($(this).data("popup"))})});var domain=$("body").data("domain"),baseroot=$("body").data("baseroot");$(document).ready(function(){function t(){var t=new TimelineMax,e=$(".open .enter-anim");t.staggerFrom(e,.3,{left:-60,autoAlpha:0},.1)}function e(){var t=new TimelineMax,e=$(".enter-anim");t.set(e,{left:0,autoAlpha:1})}function a(e){if(!$(".global--enfant.animating").length){$(".global--enfant").addClass("animating");var a=new TimelineMax,n=$(".slide[data-slide="+e+"]");n.addClass("open"),t(),a.to(n,.5,{left:0,ease:Power3.easeOut,onComplete:o})}}function n(t,e){if(!$(".global--enfant.animating").length){$(".global--enfant").addClass("animating");var a=new TimelineMax,n=e;n.removeClass("open"),a.to(n,.3,{css:{left:"100%"},ease:Power3.easeIn,onComplete:s})}}function i(t){$(".select_day_bloc").show()}var o=function(){$(".global--enfant").removeClass("animating")},s=function(){$(".global--enfant").removeClass("animating"),e()};$(".btn_slide").click(function(t){t.preventDefault(),a($(this).data("direction"))}),$(".btn--return").click(function(t){t.preventDefault();var e=$(this).parents(".slide");n($(this).data("direction"),e)}),$(".select").selectric(),$("#select_child").on("change",function(){i($(this).val())}),$("#select_day").on("change",function(){$(this).val();$(".btn_bloc_valid").show()}),$(".btn--validation_select").click(function(t){t.preventDefault();$.post("app/ride",{child:1,ride:2})}),$(".slider_avatar").slick({dots:!1,arrow:!0,infinite:!0,speed:300,centerMode:!0}),$(".btn--validation_avatar").click(function(t){if(t.preventDefault(),!$(this).parents(".slider_avatar_item.locked").length){var e=$(this).parents(".slider_avatar_item").find("img").attr("src");$(".avatar_inner img").attr("src",e),$(".slide--avatar .btn--return").trigger("click")}}),$(".btn--return").click(function(t){t.preventDefault();var e=$(this).parents(".slide");n($(this).data("direction"),e)})});